#!{{ lookPath "bash" }}
source '{{ .chezmoi.sourceDir }}/.assets/include.sh'

if [[ "$SHELL" != "$(which zsh)" ]]; then
	_log_debug "shell is not set to zsh"
	_log_info "setting shell to zsh"
	chsh -s "$(which zsh)"
fi

if ls $HOME/.ssh/id* 1> /dev/null 2>&1; then
	_log_debug "ssh keys already exist"
else
	{{ if .os.wsl }}
	if [ -d "$HOME/win/.ssh" ]; then
		_log_debug "windows ssh keys not found"
	else
		_log_info "copying windows ssh keys"
		cp $HOME/win/.ssh/id* $HOME/.ssh/
		chmod 700 $HOME/.ssh/id*
		chmod 755 $HOME/.ssh/id*.pub
	fi
	{{ else }}
	_log_info "generating ssh keys"
	ssh-keygen -t ed25519
	{{ end }}
fi
{{- if eq .domain "hrlou.net" }}
chezmoi git remote set-url origin git@git.hrlou.net:hrlou/dotfiles.git
{{- end }}

exit 0
